CREATE TABLE EMPLOYEES (
    EMPLOYEE_ID NUMBER PRIMARY KEY,
    FIRST_NAME VARCHAR2(50),
    LAST_NAME VARCHAR2(50),
    DEPARTMENT VARCHAR2(50),
    SALARY NUMBER(10,2),
    HIRE_DATE DATE
);

CREATE GLOBAL TEMPORARY TABLE TEMP_RESULTS (
    ID NUMBER,
    RESULT VARCHAR2(100)
) ON COMMIT PRESERVE ROWS;

CREATE OR REPLACE DIRECTORY data_pump_dir AS '/u01/app/oracle/admin/orcl/dpdump';

CREATE TABLE EXT_EMPLOYEES (
    ID NUMBER,
    NAME VARCHAR2(50),
    SALARY NUMBER
)
ORGANIZATION EXTERNAL
(
    TYPE ORACLE_LOADER
    DEFAULT DIRECTORY data_pump_dir
    ACCESS PARAMETERS
    (
        RECORDS DELIMITED BY NEWLINE
        FIELDS TERMINATED BY ','
        MISSING FIELD VALUES ARE NULL
    )
    LOCATION ('employees.csv')
)
REJECT LIMIT UNLIMITED;

CREATE TABLE CUSTOMER_ORDERS (
    ORDER_ID NUMBER PRIMARY KEY,
    CUSTOMER_ID NUMBER,
    ORDER_DATE DATE CONSTRAINT chk_order_date CHECK (ORDER_DATE <= SYSDATE),
    TOTAL_AMOUNT NUMBER(10,2)
);

ALTER TABLE CUSTOMER_ORDERS MODIFY ORDER_DATE DATE NOT NULL;

CREATE TABLE CATEGORIES (
    ID NUMBER PRIMARY KEY,
    CATEGORY_NAME VARCHAR2(100)
);

CREATE TABLE PRODUCTS (
    ID NUMBER PRIMARY KEY,
    NAME VARCHAR2(100),
    PRICE NUMBER(10,2),
    CATEGORY_ID NUMBER,
    CONSTRAINT fk_category FOREIGN KEY (CATEGORY_ID)
        REFERENCES CATEGORIES(ID)
);

CREATE GLOBAL TEMPORARY TABLE TEMP_REPORT (
    ID NUMBER,
    DATA VARCHAR2(100)
) ON COMMIT DELETE ROWS;

CREATE OR REPLACE DIRECTORY data_dir AS '/path/to/';
CREATE TABLE SALES_DATA (
    SALE_DATE DATE,
    PRODUCT_ID NUMBER,
    AMOUNT NUMBER
)
ORGANIZATION EXTERNAL
(
    TYPE ORACLE_LOADER
    DEFAULT DIRECTORY data_dir
    ACCESS PARAMETERS
    (
        RECORDS DELIMITED BY NEWLINE
        FIELDS TERMINATED BY ','
        MISSING FIELD VALUES ARE NULL
    )
    LOCATION ('sales.csv')
)
REJECT LIMIT UNLIMITED;

CREATE TABLE CUSTOMERS (
    CUSTOMER_ID NUMBER PRIMARY KEY,
    CUSTOMER_NAME VARCHAR2(100),
    EMAIL VARCHAR2(100),
    LAST_UPDATED TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL
);

CREATE OR REPLACE TRIGGER trg_update_last_updated
BEFORE INSERT OR UPDATE ON CUSTOMERS
FOR EACH ROW
BEGIN
    :NEW.LAST_UPDATED := SYSTIMESTAMP;
END;
/
INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (101, 'John',   'Doe',    'IT',        70000, TO_DATE('2018-05-20','YYYY-MM-DD'));

INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (102, 'Mary',   'Smith',  'HR',        55000, TO_DATE('2019-06-15','YYYY-MM-DD'));

INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (103, 'Robert', 'Brown',  'IT',        72000, TO_DATE('2020-01-10','YYYY-MM-DD'));

INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (104, 'Lisa',   'White',  'Finance',   80000, TO_DATE('2017-02-05','YYYY-MM-DD'));

INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (105, 'David',  'Clark',  'Sales',     60000, TO_DATE('2021-08-22','YYYY-MM-DD'));

INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (106, 'Karen',  'Jones',  'IT',        75000, TO_DATE('2020-11-12','YYYY-MM-DD'));

INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (107, 'Paul',   'Green',  'HR',        52000, TO_DATE('2016-03-29','YYYY-MM-DD'));

INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (108, 'Nancy',  'Adams',  'Sales',     58000, TO_DATE('2022-01-17','YYYY-MM-DD'));

INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (109, 'Tom',    'Lee',    'Finance',   90000, TO_DATE('2015-09-01','YYYY-MM-DD'));

INSERT INTO EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, DEPARTMENT, SALARY, HIRE_DATE)
VALUES (110, 'Emily',  'Davis',  'IT',        68000, TO_DATE('2023-04-10','YYYY-MM-DD'));

COMMIT;

INSERT INTO CATEGORIES VALUES (1, 'Electronics');
INSERT INTO CATEGORIES VALUES (2, 'Furniture');
INSERT INTO CATEGORIES VALUES (3, 'Clothing');
INSERT INTO CATEGORIES VALUES (4, 'Sports');
INSERT INTO CATEGORIES VALUES (5, 'Books');
INSERT INTO CATEGORIES VALUES (6, 'Home Appliances');
INSERT INTO CATEGORIES VALUES (7, 'Beauty');
INSERT INTO CATEGORIES VALUES (8, 'Toys');
INSERT INTO CATEGORIES VALUES (9, 'Groceries');
INSERT INTO CATEGORIES VALUES (10, 'Garden');

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (101, 'Smartphone',          750.00, 1);

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (102, 'Laptop',             1200.00, 1);

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (103, 'Microwave Oven',      300.00, 2);

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (104, 'Refrigerator',        950.00, 2);

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (105, 'Sofa Set',           1500.00, 3);

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (106, 'Dining Table',        850.00, 3);

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (107, 'T-Shirt',              25.00, 4);

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (108, 'Jeans',                45.00, 4);

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (109, 'Football',             30.00, 5);

INSERT INTO PRODUCTS (ID, NAME, PRICE, CATEGORY_ID)
VALUES (110, 'Tennis Racket',       120.00, 5);

COMMIT;

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (1, 'John Doe', 'john.doe@example.com');

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (2, 'Mary Smith', 'mary.smith@example.com');

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (3, 'Robert Brown', 'robert.brown@example.com');

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (4, 'Lisa White', 'lisa.white@example.com');

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (5, 'David Clark', 'david.clark@example.com');

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (6, 'Karen Jones', 'karen.jones@example.com');

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (7, 'Paul Green', 'paul.green@example.com');

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (8, 'Nancy Adams', 'nancy.adams@example.com');

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (9, 'Tom Lee', 'tom.lee@example.com');

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME, EMAIL)
VALUES (10, 'Emily Davis', 'emily.davis@example.com');

COMMIT;

ALTER TABLE EMPLOYEES SET UNUSED COLUMN DEPARTMENT;

CREATE PRIVATE TEMPORARY TABLE ora$ptt_temp_results
(
    id NUMBER,
    result VARCHAR2(100)
)
ON COMMIT PRESERVE DEFINITION;

CREATE TABLE ext_employees (
    id NUMBER,
    name VARCHAR2(50),
    salary NUMBER
)
ORGANIZATION EXTERNAL (
    TYPE ORACLE_LOADER
    DEFAULT DIRECTORY data_pump_dir
    ACCESS PARAMETERS (
        RECORDS DELIMITED BY NEWLINE
        FIELDS TERMINATED BY ',' 
        OPTIONALLY ENCLOSED BY '"'
        MISSING FIELD VALUES ARE NULL
    )
    LOCATION ('employees.csv')
)
REJECT LIMIT UNLIMITED;

CONSTRAINT chk_order_date CHECK (order_date IS NOT NULL AND order_date <= SYSDATE);

select order_date DATE NOT NULL DEFAULT SYSDATE CHECK (order_date <= SYSDATE);

ALTER TABLE PRODUCTS 
ADD CONSTRAINT fk_category 
FOREIGN KEY (category_id) REFERENCES CATEGORIES(id);

CREATE GLOBAL TEMPORARY TABLE temp_report (
    id NUMBER,
    data VARCHAR2(100)
) ON COMMIT DELETE ROWS;

CREATE EXTERNAL TABLE sales_data (
    date DATE,
    product_id NUMBER,
    amount NUMBER
) ORGANIZATION EXTERNAL (
    TYPE ORACLE_DATAPUMP
    DEFAULT DIRECTORY data_dir
    ACCESS PARAMETERS (FIELDS TERMINATED BY ',')
    LOCATION ('sales.csv')
);

CREATE VIEW sales_data AS SELECT * FROM CSVREAD('/path/to/sales.csv');

CREATE EXTERNAL TABLE sales_data (
    date DATE,
    product_id NUMBER,
    amount NUMBER
) ORGANIZATION EXTERNAL (
    TYPE ORACLE_LOADER
    DEFAULT DIRECTORY data_dir
    ACCESS PARAMETERS (
        RECORDS DELIMITED BY NEWLINE
        FIELDS TERMINATED BY ','
    )
    LOCATION ('sales.csv')
);

ALTER TABLE CUSTOMERS ADD last_updated TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL;

ALTER TABLE CUSTOMERS ADD last_updated TIMESTAMP DEFAULT SYSTIMESTAMP ON UPDATE SYSTIMESTAMP;
